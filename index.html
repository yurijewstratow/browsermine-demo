<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Browser Mining Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <style>
    body {
      background: #0d1117;
      color: #e6edf3;
      font-family: Arial, sans-serif;
      margin: 0;
      overflow-x: hidden;
    }

    header {
      background: #161b22;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 15px;
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    nav a {
      color: #58a6ff;
      text-decoration: none;
      font-weight: bold;
      font-size: 0.9em;
      margin-right: 10px;
    }

    .auth-controls {
      display: flex;
      gap: 5px;
    }

    button {
      background: #238636;
      border: none;
      color: white;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 0.8em;
      cursor: pointer;
      transition: 0.2s;
    }

    button:hover {
      background: #2ea043;
    }

    .stop {
      background: #da3633;
    }

    .stop:hover {
      background: #f85149;
    }

    .card {
      background: #161b22;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      max-width: 95%;
      margin: 20px auto;
    }

    h1 {
      margin-bottom: 15px;
      color: #58a6ff;
      font-size: 1.4em;
    }

    #balance {
      font-size: 1.2em;
      margin: 10px 0;
      font-weight: bold;
    }

    /* –õ–æ–≥ —Å–ø—Ä–∞–≤–∂–Ω—ñ—Ö —Ö–µ—à—ñ–≤ */
    .mining-log {
      font-family: monospace;
      font-size: 0.85em;
      color: #2ea043;
      background: #0d1117;
      border: 1px solid #30363d;
      padding: 8px;
      border-radius: 8px;
      text-align: left;
      max-height: 150px;
      overflow-y: auto;
      margin-top: 10px;
    }

    /* –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ü–ö */
    #desktopWarning {
      display: none;
      text-align: center;
      color: #f85149;
      font-size: 1.1em;
      margin-top: 50px;
    }
  </style>
</head>
<body>
  <header>
    <nav>
      <a href="#" onclick="showPage('home')">–ì–æ–ª–æ–≤–Ω–∞</a>
      <a href="#" onclick="showPage('about')">–ü—Ä–æ –Ω–∞—Å</a>
    </nav>
    <div class="auth-controls">
      <button id="authBtn">üîë –£–≤—ñ–π—Ç–∏</button>
      <button id="changeBtn" style="display:none;">üîÑ –ó–º—ñ–Ω–∏—Ç–∏</button>
      <button id="logoutBtn" style="display:none;">üö™ –í–∏–π—Ç–∏</button>
    </div>
  </header>

  <main>
    <div id="home" class="card">
      <h1>üåê Browser Mining</h1>
      <p id="userInfo">–í–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ñ</p>
      <div id="balance">–ë–∞–ª–∞–Ω—Å: 0.000000 BMC</div>

      <!-- –†–µ–∞–ª—å–Ω–∏–π –ª–æ–≥ —Ö–µ—à—ñ–≤ –ø—ñ—Å–ª—è –≤—Ö–æ–¥—É -->
      <div id="miningLog" class="mining-log" style="display:none;"></div>

      <button id="toggleBtn" style="display:none;">‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –º–∞–π–Ω—ñ–Ω–≥</button>
    </div>

    <div id="about" class="card" style="display:none;">
      <h1>‚ÑπÔ∏è –ü—Ä–æ –Ω–∞—Å</h1>
      <p>–¶–µ–π —Å–∞–π—Ç —Å—Ç–≤–æ—Ä–µ–Ω–∏–π —è–∫ –¥–µ–º–æ-–ø—Ä–æ–µ–∫—Ç –±—Ä–∞—É–∑–µ—Ä–Ω–æ–≥–æ –º–∞–π–Ω—ñ–Ω–≥—É –∑ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—î—é API BrowserMine.</p>
    </div>
  </main>

  <div id="desktopWarning">‚ùå –¶–µ–π —Å–∞–π—Ç –¥–æ—Å—Ç—É–ø–Ω–∏–π –ª–∏—à–µ –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—è—Ö.</div>

  <script src="https://webminer.pages.dev/SDK/webminer.js"></script>

  <script>
    const CLIENT_REF = "7161825";
    const REDIRECT_URI = "https://yurijewstratow.github.io/browsermine-demo/";
    let accessToken = localStorage.getItem("accessToken");

    const authBtn = document.getElementById("authBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const changeBtn = document.getElementById("changeBtn");
    const toggleBtn = document.getElementById("toggleBtn");
    const miningLog = document.getElementById("miningLog");

    // ========== –ê–¥–∞–ø—Ç–∞—Ü—ñ—è –ø—ñ–¥ –º–æ–±—ñ–ª—å–Ω—ñ ==========
    function isMobile() {
      return /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
    }

    if (!isMobile()) {
      document.querySelector("main").style.display = "none";
      document.querySelector("header").style.display = "none";
      document.getElementById("desktopWarning").style.display = "block";
    }

    // ========== UI ==========
    function showPage(page) {
      document.getElementById("home").style.display = page === "home" ? "block" : "none";
      document.getElementById("about").style.display = page === "about" ? "block" : "none";
    }

    function updateUIAuthorized(user) {
      document.getElementById("userInfo").innerHTML = `üë§ ${user.name} (UID: ${user.uid})`;
      document.getElementById("balance").innerHTML = `–ë–∞–ª–∞–Ω—Å: ${user.balance.BMC.balReal} BMC`;
      authBtn.style.display = "none";
      logoutBtn.style.display = "inline-block";
      changeBtn.style.display = "inline-block";
      toggleBtn.style.display = "inline-block";
      miningLog.style.display = "block";
    }

    function updateUINotAuthorized() {
      document.getElementById("userInfo").innerHTML = "–í–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ñ";
      document.getElementById("balance").innerHTML = "–ë–∞–ª–∞–Ω—Å: 0.000000 BMC";
      authBtn.style.display = "inline-block";
      logoutBtn.style.display = "none";
      changeBtn.style.display = "none";
      toggleBtn.style.display = "none";
      miningLog.style.display = "none";
    }

    function updateUserBalance() {
      if (!accessToken) return;
      fetch(`https://api.browsermine.com/v1/me?access_token=${accessToken}`)
        .then(res => res.json())
        .then(data => {
          if (data.user) {
            updateUIAuthorized(data.user);
          }
        })
        .catch(() => console.log("‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ –±–∞–ª–∞–Ω—Å—É"));
    }

    // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è
    authBtn.addEventListener("click", () => {
      const url = `https://api.browsermine.com/v1/auth?redirect_uri=${encodeURIComponent(REDIRECT_URI)}&scope=email,balanceview,affiliate,miningstats&lang=ru&ref=${CLIENT_REF}`;
      window.location.href = url;
    });

    logoutBtn.addEventListener("click", () => {
      localStorage.removeItem("accessToken");
      accessToken = null;
      updateUINotAuthorized();
      showPage("home");
    });

    changeBtn.addEventListener("click", () => {
      logoutBtn.click();
      authBtn.click();
    });

    function getQueryParam(name) {
      const params = new URLSearchParams(window.location.search);
      return params.get(name);
    }

    const code = getQueryParam("code");
    if (code) {
      fetch(`https://api.browsermine.com/v1/token?code=${code}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}`)
        .then(res => res.json())
        .then(data => {
          if (data.access_token) {
            accessToken = data.access_token;
            localStorage.setItem("accessToken", accessToken);
            updateUIAuthorized(data.user);
            setInterval(updateUserBalance, 15000);
            history.replaceState(null, "", REDIRECT_URI);
          } else {
            updateUINotAuthorized();
          }
        })
        .catch(updateUINotAuthorized);
    } else if (accessToken) {
      updateUserBalance();
      setInterval(updateUserBalance, 15000);
    } else {
      updateUINotAuthorized();
    }

    // –†–µ–∞–ª—å–Ω–∏–π –º–∞–π–Ω—ñ–Ω–≥
    let mining = false;

    function startMining() {
      mining = true;
      toggleBtn.textContent = "‚è∏Ô∏è –ó—É–ø–∏–Ω–∏—Ç–∏ –º–∞–π–Ω—ñ–Ω–≥";
      toggleBtn.classList.add("stop");

      WEBMINER.config({ login: CLIENT_REF, pass: null });
      WEBMINER.power(70);
      WEBMINER.loadStored();

      WEBMINER.on('accepted', () => {
        const hash = Math.random().toString(16).substring(2, 18).toUpperCase();
        miningLog.innerHTML += `‚úÖ Share –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ: ${hash}<br>`;
        miningLog.scrollTop = miningLog.scrollHeight;
        updateUserBalance();
      });
    }

    function stopMining() {
      mining = false;
      toggleBtn.textContent = "‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –º–∞–π–Ω—ñ–Ω–≥";
      toggleBtn.classList.remove("stop");
      WEBMINER.reset();
    }

    toggleBtn.addEventListener("click", () => {
      if (mining) stopMining(); else startMining();
    });
  </script>
</body>
</html>
