<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Browser Mining Demo</title>
  <style>
    body {
      background: #0d1117;
      color: #e6edf3;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
    }
    .card {
      background: #161b22;
      padding: 30px;
      border-radius: 15px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      max-width: 420px;
    }
    h1 {
      margin-bottom: 20px;
      color: #58a6ff;
    }
    #balance {
      font-size: 1.5em;
      margin: 15px 0;
      font-weight: bold;
    }
    button {
      background: #238636;
      border: none;
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 1em;
      cursor: pointer;
      transition: 0.2s;
      margin: 5px;
    }
    button:hover {
      background: #2ea043;
    }
    .stop {
      background: #da3633;
    }
    .stop:hover {
      background: #f85149;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>üåê Browser Mining</h1>
    <p id="userInfo">–í–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ñ</p>
    <div id="balance">–ë–∞–ª–∞–Ω—Å: 0.000000 BMC</div>
    <button id="authBtn">üîë –£–≤—ñ–π—Ç–∏ —á–µ—Ä–µ–∑ BrowserMine</button>
    <button id="toggleBtn">‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –º–∞–π–Ω—ñ–Ω–≥</button>
  </div>

  <!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è WebMiner SDK -->
  <script src="https://webminer.pages.dev/SDK/webminer.js"></script>

  <script>
    // ===== –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è =====
    const CLIENT_REF = "7161825"; // —Ç–≤—ñ–π —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∏–π ID
    const REDIRECT_URI = "https://yurijewstratow.github.io/browsermine-demo/"; // GitHub Pages URL
    let accessToken = null; // —Ç—É—Ç –∑–±–µ—Ä—ñ–≥–∞—Ç–∏–º–µ–º–æ —Ç–æ–∫–µ–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

    // ===== –ö–Ω–æ–ø–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó =====
    document.getElementById("authBtn").addEventListener("click", () => {
      const url = `https://api.browsermine.com/v1/auth?redirect_uri=${encodeURIComponent(REDIRECT_URI)}&scope=email,balanceview,affiliate,miningstats&lang=ru&ref=${CLIENT_REF}`;
      window.location.href = url; // —Ä–µ–¥—ñ—Ä–µ–∫—Ç –Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é BrowserMine
    });

    // ===== –û—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ code –ø—ñ—Å–ª—è —Ä–µ–¥—ñ—Ä–µ–∫—Ç—É =====
    function getQueryParam(name) {
      const params = new URLSearchParams(window.location.search);
      return params.get(name);
    }

    // ===== –§—É–Ω–∫—Ü—ñ—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –±–∞–ª–∞–Ω—Å—É –∑ API =====
    function updateUserBalance() {
      if (!accessToken) return;
      fetch(`https://api.browsermine.com/v1/me?access_token=${accessToken}`)
        .then(res => res.json())
        .then(data => {
          if (data.user) {
            document.getElementById("balance").innerHTML = `–ë–∞–ª–∞–Ω—Å: ${data.user.balance.BMC.balReal} BMC`;
          }
        })
        .catch(() => console.log("‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ –±–∞–ª–∞–Ω—Å—É"));
    }

    // ===== –û–±—Ä–æ–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó =====
    const code = getQueryParam("code");
    if (code) {
      fetch(`https://api.browsermine.com/v1/token?code=${code}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}`)
        .then(res => res.json())
        .then(data => {
          if (data.access_token) {
            accessToken = data.access_token;
            document.getElementById("userInfo").innerHTML = `üë§ ${data.user.name} (UID: ${data.user.uid})`;
            document.getElementById("balance").innerHTML = `–ë–∞–ª–∞–Ω—Å: ${data.user.balance.BMC.balReal} BMC`;

            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –±–∞–ª–∞–Ω—Å—É –∫–æ–∂–Ω—ñ 15 —Å–µ–∫—É–Ω–¥
            setInterval(updateUserBalance, 15000);
          } else {
            document.getElementById("userInfo").innerHTML = "‚ùå –ü–æ–º–∏–ª–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó";
          }
        })
        .catch(() => {
          document.getElementById("userInfo").innerHTML = "‚ö†Ô∏è –ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–∞–Ω—ñ";
        });
    }

    // ===== –†–µ–∞–ª—å–Ω–∏–π –º–∞–π–Ω—ñ–Ω–≥ —á–µ—Ä–µ–∑ WebMiner =====
    let mining = false;
    const btn = document.getElementById("toggleBtn");

    function startMining() {
      mining = true;
      btn.textContent = "‚è∏Ô∏è –ó—É–ø–∏–Ω–∏—Ç–∏ –º–∞–π–Ω—ñ–Ω–≥";
      btn.classList.add("stop");

      WEBMINER.config({ login: CLIENT_REF, pass: null });
      WEBMINER.power(70); // –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è 70% CPU
      WEBMINER.loadStored();

      WEBMINER.on('accepted', () => {
        console.log("‚úÖ New share –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ");
        updateUserBalance(); // –º–∏—Ç—Ç—î–≤–æ –æ–Ω–æ–≤–∏—Ç–∏ –±–∞–ª–∞–Ω—Å –ø—ñ—Å–ª—è —à–µ–π—Ä—É
      });
    }

    function stopMining() {
      mining = false;
      btn.textContent = "‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –º–∞–π–Ω—ñ–Ω–≥";
      btn.classList.remove("stop");
      WEBMINER.reset();
    }

    btn.addEventListener("click", () => {
      if (mining) stopMining(); else startMining();
    });
  </script>
</body>
</html>
