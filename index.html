<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Browser Mining Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {background:#0d1117;color:#e6edf3;font-family:Arial,sans-serif;margin:0;padding:0;}
    .tab-menu{
      display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;
      background-color:#161b22;padding:10px;box-shadow:0 2px 5px rgba(0,0,0,0.3);position:sticky;top:0;z-index:100;
    }
    .tabs-left {display:flex;flex-wrap:wrap;}
    .tabs-left button{background:none;border:none;color:#e6edf3;padding:10px 20px;cursor:pointer;font-size:1em;transition:0.2s;margin:2px;}
    .tabs-left button:hover{background-color:#238636;border-radius:8px;}
    .tabs-left button.active{background-color:#58a6ff;border-radius:8px;color:#0d1117;}
    .tabs-right {display:flex;flex-wrap:wrap;align-items:center;}
    .tabs-right button{background:#238636;border:none;color:white;padding:8px 15px;border-radius:8px;font-size:0.9em;cursor:pointer;margin:2px;transition:0.2s;}
    .tabs-right button:hover{background:#2ea043;}
    .tabs-right button.logout{background:#da3633;}
    .tabs-right button.logout:hover{background:#f85149;}
    .user-name{margin-right:10px;font-weight:bold;color:#58a6ff;}
    .tab-content{display:none;max-width:600px;margin:30px auto;padding:20px;background:#161b22;border-radius:15px;box-shadow:0 4px 12px rgba(0,0,0,0.3);}
    .tab-content.active{display:block;}
    #mainSection button{background:#238636;border:none;color:white;padding:10px 20px;border-radius:8px;font-size:1em;cursor:pointer;transition:0.2s;margin:5px;}
    #mainSection button:hover{background:#2ea043;}
    #mainSection button.stop{background:#da3633;}
    #mainSection button.stop:hover{background:#f85149;}
    #balance{font-size:1.5em;margin:15px 0;font-weight:bold;}
    .modal{display:none;position:fixed;z-index:200;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,0.8);justify-content:center;align-items:center;}
    .modal-content{background-color:#161b22;width:90%;max-width:500px;height:80%;border-radius:15px;position:relative;padding:10px;display:flex;flex-direction:column;}
    .modal iframe{flex:1;border:none;border-radius:10px;}
    .close{color:#f85149;font-size:28px;font-weight:bold;cursor:pointer;position:absolute;top:10px;right:20px;}
    .close:hover{color:#da3633;}
    @media screen and (max-width:480px){
      .tab-menu{flex-direction:column;align-items:flex-start;}
      .tabs-left,.tabs-right{width:100%;justify-content:flex-start;margin:2px 0;}
      #mainSection,#aboutSection{margin:20px 10px;padding:15px;}
      #balance{font-size:1.2em;}
      #mainSection button{padding:8px 15px;font-size:0.9em;}
      .tabs-right button{margin:2px 5px 2px 0;}
    }
  </style>
</head>
<body>
  <!-- –í–µ—Ä—Ö–Ω—î –º–µ–Ω—é -->
  <div class="tab-menu">
    <div class="tabs-left">
      <button class="tab-link active" data-tab="mainSection">–ì–æ–ª–æ–≤–Ω–∞</button>
      <button class="tab-link" data-tab="aboutSection">–û –Ω–∞—Å</button>
    </div>
    <div class="tabs-right">
      <span id="userName" class="user-name" style="display:none;"></span>
      <button id="authBtn">üîë –£–≤—ñ–π—Ç–∏</button>
      <button id="logoutBtn" style="display:none;" class="logout">üö™ –í–∏–π—Ç–∏</button>
      <button id="switchBtn">üîÑ –ó–º—ñ–Ω–∏—Ç–∏ –∞–∫–∞—É–Ω—Ç</button>
    </div>
  </div>

  <!-- –í–∫–ª–∞–¥–∫–∞ –ì–æ–ª–æ–≤–Ω–∞ -->
  <div id="mainSection" class="tab-content active">
    <h1 style="text-align:center; color:#58a6ff;">üåê Browser Mining</h1>
    <p id="userInfo">–í–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ñ</p>
    <div id="balance">–ë–∞–ª–∞–Ω—Å: 0.000000 BMC</div>
    <div style="text-align:center;">
      <button id="toggleBtn">‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –º–∞–π–Ω—ñ–Ω–≥</button>
    </div>
  </div>

  <!-- –í–∫–ª–∞–¥–∫–∞ –û –Ω–∞—Å -->
  <div id="aboutSection" class="tab-content">
    <h2 style="text-align:center; color:#58a6ff;">–ü—Ä–æ —Å–∞–π—Ç Browser Mining Demo</h2>
    <p>–¶–µ–π –ø—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î, —è–∫ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –≤–µ–±-—Å–∞–π—Ç –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–Ω–æ–≥–æ –º–∞–π–Ω—ñ–Ω–≥—É –∑ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—î—é BrowserMine.com...</p>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó -->
  <div id="authModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <iframe id="authFrame" src=""></iframe>
    </div>
  </div>

  <script src="https://webminer.pages.dev/SDK/webminer.js"></script>
  <script>
    // –ú–µ–Ω—é –≤–∫–ª–∞–¥–æ–∫
    const tabLinks = document.querySelectorAll(".tab-link");
    const tabContents = document.querySelectorAll(".tab-content");
    tabLinks.forEach(btn=>btn.addEventListener("click",()=>{
      tabLinks.forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");
      const tab = btn.getAttribute("data-tab");
      tabContents.forEach(c=>c.id===tab?c.classList.add("active"):c.classList.remove("active"));
    }));

    // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
    const CLIENT_REF="7161825";
    const REDIRECT_URI="https://yurijewstratow.github.io/browsermine-demo/";
    let accessToken=null; let mining=false;
    const userInfoEl=document.getElementById("userInfo");
    const balanceEl=document.getElementById("balance");
    const authBtn=document.getElementById("authBtn");
    const switchBtn=document.getElementById("switchBtn");
    const logoutBtn=document.getElementById("logoutBtn");
    const toggleBtn=document.getElementById("toggleBtn");
    const userNameEl=document.getElementById("userName");

    // –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
    const modal=document.getElementById("authModal");
    const iframe=document.getElementById("authFrame");
    const closeModal=document.querySelector(".close");
    function openAuthModal(){iframe.src=`https://api.browsermine.com/v1/auth?redirect_uri=${encodeURIComponent(REDIRECT_URI)}&scope=email,balanceview,affiliate,miningstats&lang=ru&ref=${CLIENT_REF}`; modal.style.display="flex";}
    authBtn.addEventListener("click",openAuthModal);
    closeModal.addEventListener("click",()=>modal.style.display="none");
    window.addEventListener("click",e=>{if(e.target==modal) modal.style.display="none";});

    // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è —Ç–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω–∞
    function getQueryParam(name){const params=new URLSearchParams(window.location.search);return params.get(name);}
    function updateUserBalance(){
      if(!accessToken)return;
      fetch(`https://api.browsermine.com/v1/me?access_token=${accessToken}`)
        .then(res=>res.json())
        .then(data=>{
          if(data.user){
            balanceEl.innerHTML=`–ë–∞–ª–∞–Ω—Å: ${data.user.balance.BMC.balReal} BMC`;
          }
        })
        .catch(()=>console.log("‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ –±–∞–ª–∞–Ω—Å—É"));
    }

    function handleAuth(code){
      fetch(`https://api.browsermine.com/v1/token?code=${code}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}`)
      .then(res=>res.json()).then(data=>{
        if(data.access_token){
          accessToken=data.access_token;
          localStorage.setItem('bm_access_token', accessToken);

          // –í—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ —ñ–º‚Äô—è
          userInfoEl.innerHTML=`üë§ ${data.user.name} (UID: ${data.user.uid})`;
          userNameEl.textContent=data.user.name;
          userNameEl.style.display="inline-block";

          balanceEl.innerHTML=`–ë–∞–ª–∞–Ω—Å: ${data.user.balance.BMC.balReal} BMC`;

          setInterval(updateUserBalance,15000);
          modal.style.display="none";
          authBtn.style.display="none";
          logoutBtn.style.display="inline-block";
        }else{
          userInfoEl.innerHTML="‚ùå –ü–æ–º–∏–ª–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó";
        }
      }).catch(()=>userInfoEl.innerHTML="‚ö†Ô∏è –ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–∞–Ω—ñ");
    }

    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
    window.addEventListener("load", ()=>{
      const storedToken = localStorage.getItem('bm_access_token');
      if(storedToken){
        accessToken = storedToken;
        updateUserBalance();
        authBtn.style.display="none";
        logoutBtn.style.display="inline-block";
        fetch(`https://api.browsermine.com/v1/me?access_token=${accessToken}`)
          .then(res=>res.json())
          .then(data=>{
            if(data.user){
              userInfoEl.innerHTML=`üë§ ${data.user.name} (UID: ${data.user.uid})`;
              userNameEl.textContent=data.user.name;
              userNameEl.style.display="inline-block";
            }
          })
          .catch(()=>{userInfoEl.innerHTML="–í–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ñ";});
      }
    });

    const code=getQueryParam("code");
    if(code) handleAuth(code);

    // –í–∏—Ö—ñ–¥
    logoutBtn.addEventListener("click",()=>{
      if(mining){WEBMINER.reset(); mining=false; toggleBtn.textContent="‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –º–∞–π–Ω—ñ–Ω–≥"; toggleBtn.classList.remove("stop");}
      accessToken=null;
      localStorage.removeItem('bm_access_token');
      userInfoEl.innerHTML="–í–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ñ";
      userNameEl.style.display="none";
      balanceEl.innerHTML="–ë–∞–ª–∞–Ω—Å: 0.000000 BMC";
      logoutBtn.style.display="none";
      authBtn.style.display="inline-block";
    });

    // –ú–∞–π–Ω—ñ–Ω–≥
    function startMining(){
      mining=true;
      toggleBtn.textContent="‚è∏Ô∏è –ó—É–ø–∏–Ω–∏—Ç–∏ –º–∞–π–Ω—ñ–Ω–≥";
      toggleBtn.classList.add("stop");
      WEBMINER.config({login:CLIENT_REF,pass:null});
      WEBMINER.power(70);
      WEBMINER.loadStored();
      WEBMINER.on('accepted',()=>updateUserBalance());
    }
    function stopMining(){
      mining=false;
      toggleBtn.textContent="‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –º–∞–π–Ω—ñ–Ω–≥";
      toggleBtn.classList.remove("stop");
      WEBMINER.reset();
    }
    toggleBtn.addEventListener("click",()=>{mining?stopMining():startMining();});

    // –ó–º—ñ–Ω–∏—Ç–∏ –∞–∫–∞—É–Ω—Ç
    switchBtn.addEventListener("click",()=>{
      if(mining) stopMining();
      accessToken=null;
      userInfoEl.innerHTML="–í–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ñ";
      userNameEl.style.display="none";
      balanceEl.innerHTML="–ë–∞–ª–∞–Ω—Å: 0.000000 BMC";
      authBtn.style.display="inline-block";
      logoutBtn.style.display="none";
      openAuthModal();
    });
  </script>
</body>
</html>
